<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC Share Data Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .container {
            max-width: 800px;
        }
        .card-header {
            font-weight: bold;
        }
        .card-body .value {
            font-size: 2.5rem;
            font-weight: 300;
            color: #212529;
            word-wrap: break-word;
        }
        .card-body .year {
            font-size: 1.2rem;
            color: #6c757d;
        }
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1050;
        }
        .data-container.loading .loading-spinner {
            display: block;
        }
        .data-container.loading .content-wrapper {
            opacity: 0.3;
            pointer-events: none;
        }
        .error-message {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container mt-5 pt-4 pb-4 data-container">
        <div class="loading-spinner">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <div class="content-wrapper">
            <header class="text-center mb-4">
                <h1 id="share-entity-name">Loading...</h1>
                <p class="lead text-muted">Outstanding Common Stock Shares (Post-2020)</p>
            </header>

            <main>
                <div class="alert alert-danger error-message" role="alert"></div>
                <div class="row g-4" id="results-container">
                    <div class="col-md-6">
                        <div class="card text-center border-success shadow-sm h-100">
                            <div class="card-header bg-success-subtle text-success-emphasis border-success">
                                Maximum Shares
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center">
                                <p class="value" id="share-max-value">...</p>
                                <p class="year mb-0">Fiscal Year: <span id="share-max-fy">...</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card text-center border-danger shadow-sm h-100">
                            <div class="card-header bg-danger-subtle text-danger-emphasis border-danger">
                                Minimum Shares
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center">
                                <p class="value" id="share-min-value">...</p>
                                <p class="year mb-0">Fiscal Year: <span id="share-min-fy">...</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="text-center text-muted mt-5">
                <p><small>Data sourced from U.S. Securities and Exchange Commission.</small></p>
                <p><small>To view data for another company, add <code>?CIK=0001018724</code> to the URL (replace with a 10-digit CIK).</small></p>
            </footer>
        </div>
    </div>

    <!-- Embedded attachment as required by brief -->
    <script type="text/plain" id="uid.txt">3993095972954057475306036749842326864406623475597277091066</script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const defaultCik = '0001316835';
            const params = new URLSearchParams(window.location.search);
            const queryCik = params.get('CIK');
            
            const cikToFetch = (queryCik && /^\d{10}$/.test(queryCik)) ? queryCik : defaultCik;
            
            fetchAndProcessData(cikToFetch);
        });

        function showLoading(isLoading) {
            const container = document.querySelector('.data-container');
            if (isLoading) {
                container.classList.add('loading');
            } else {
                container.classList.remove('loading');
            }
        }

        function showError(message) {
            const errorEl = document.querySelector('.error-message');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('share-entity-name').textContent = 'Error';
        }

        function updateDOM(data) {
            const { entityName, max, min } = data;
            
            document.title = `${entityName} | Share Data`;
            document.getElementById('share-entity-name').textContent = entityName;
            
            document.getElementById('share-max-value').textContent = max.val.toLocaleString();
            document.getElementById('share-max-fy').textContent = max.fy;
            
            document.getElementById('share-min-value').textContent = min.val.toLocaleString();
            document.getElementById('share-min-fy').textContent = min.fy;
        }

        async function fetchAndProcessData(cik) {
            showLoading(true);
            
            // Per SEC guidance, a descriptive User-Agent is required for programmatic access.
            // This is for server-side scripts. In browsers, this header is controlled.
            // Using a proxy as suggested in the brief.
            const userAgent = 'MyCompany Name myemail@mycompany.com';
            const secApiUrl = `https://data.sec.gov/api/xbrl/companyconcept/CIK${cik}/dei/EntityCommonStockSharesOutstanding.json`;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(secApiUrl)}`;

            try {
                const response = await fetch(proxyUrl, {
                    headers: { 'User-Agent': userAgent }
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status: ${response.status}`);
                }
                
                const rawData = await response.json();

                const entityName = rawData.entityName || `Company (CIK: ${cik})`;
                const shares = rawData.units?.shares;

                if (!shares || !Array.isArray(shares) || shares.length === 0) {
                    throw new Error('No common stock share data found for this entity.');
                }

                const filteredShares = shares.filter(
                    s => s.fy > 2020 && typeof s.val === 'number'
                );

                if (filteredShares.length === 0) {
                    throw new Error('No share data found for fiscal years after 2020.');
                }
                
                const initial = filteredShares[0];
                const minData = filteredShares.reduce((min, current) => (current.val < min.val ? current : min), initial);
                const maxData = filteredShares.reduce((max, current) => (current.val > max.val ? current : max), initial);

                const processedData = {
                    entityName: entityName,
                    max: {
                        val: maxData.val,
                        fy: String(maxData.fy)
                    },
                    min: {
                        val: minData.val,
                        fy: String(minData.fy)
                    }
                };
                
                updateDOM(processedData);

            } catch (error) {
                console.error('Error:', error);
                showError(`Could not retrieve or process data for CIK ${cik}. ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
    </script>
</body>
</html>